## HTTP请求流程
从图中可以看到，浏览器的HTTP请求从发起到结束一共经历了如下八个阶段：构建请求、查找缓存、准备IP和端口、等待TCP队列、建立TCP链接、发起HTTP请求、服务器处理请求、服务器返回请求、断开连接。

![HTTP请求流程](../../Images/浏览器/HTTP请求流程.png)

1. **构建请求** 浏览器构建请求行信息（如下所示），构建好后，浏览器准备发起网络请求。
```
GET /index.html HTTP1.1
```

2. **查找缓存** 一般http缓存有强缓存和协商缓存之分、具体见HTTP缓存篇

3. **准备IP地址和端口** 

浏览器使用**HTTP协议作为应用层协议**，用来封装请求的文本信息；并使用**TCP/IP作为传输层协议**将他发布到网络上。所以在HTTP开始工作之前，浏览器需要通过TCP与服务器建立连接。也就是说**HTTP的内容是通过TCP的传输数据阶段来实现的**。

通过URL地址获取IP地址和端口。域名解析成IP地址，这里有一个**域名系统（DNS）**。拿到IP地址之后，如果URL没有指明端口，默认80。

4. **等待TCP队列**

Chrome 有个机制，同一个域名同时最多只能建立 6 个 TCP 连接，如果在同一个域名下同时有 10 个请求发生，那么其中 4 个请求会进入排队等待状态，直至进行中的请求完成。

5. **建立TCP连接** 三次握手

6. **发送HTTP请求**

![HTTP请求数据格式](../../Images/浏览器/HTTP请求数据格式.png)
浏览器会向服务器发送请求行，它包括了请求方法、请求 URI（Uniform Resource Identifier）和 HTTP 版本协议。

7. **返回请求**

![服务器响应的数据格式](../../Images/浏览器/服务器响应的数据格式.png)

8. **断开连接**

通常情况下，一旦服务器向客户端返回了请求数据，它就要关闭 TCP 连接。不过如果浏览器或者服务器在其头信息中加入了：
```
Connection:Keep-Alive 
```

那么 TCP 连接在发送后将仍然保持打开状态，这样浏览器就可以继续通过同一个 TCP 连接发送请求。保持 TCP 连接可以省去下次请求时需要建立连接的时间，提升资源加载速度。


## 登录状态是怎么保持的（cookie）

用户输入密码。发送请求到服务器，如果服务器验证正确，在返回的响应头内就有Set-Cookie 的字段，那么浏览器就会将该字段的内容保持到本地。当下次客户端再往该服务器发送请求时，客户端会自动在请求头中加入 Cookie 值后再发送出去。服务器端发现客户端发送过来的 Cookie 后，会去检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到该用户的状态信息。
![cookie流程](../../Images/浏览器/cookie流程.png)
