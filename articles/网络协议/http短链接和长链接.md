## HTTP的连接管理
由于HTTP的通信过程采用的是请求-应答”方式。所以http性能有短板，不算好。

#### 短链接
+ 客户端与服务器的整个连接过程很短暂，不会与服务器保持长时间的连接状态。
+ http底层的数据传输基于TCP/IP，每次发送请求前需要先与服务器建立连接，收到响应报文后会立即关闭连接。
+ 建立链接：TCP三次握手；关闭链接：TCP四次挥手。

每一次都要建立，关闭链接。非常浪费资源。

#### 长链接
不会每一次都建立，关闭链接。选在在合适的时候，关闭链接。
![http_长链接](../../Images/http/http_长链接.png)

#### 连接相关的头字段
HTTP/1.1中的连接都会默认启用长连接。不需要用什么特殊的头字段指定，只要向服务器发送了第一次请求，后续的请求都会重复利用第一次打开的TCP连接，也就是 长连接，在这个连接上收发数据。
###### Connection
+ 客户端可以在请求头设置``Connection: keep-alive``，使用长链接。
+ 服务器支持长连接，它总会在响应报文里放一个``Connection: keep-alive``字段。
+ 客户端，可以在请求头里加上``Connection: close``字段，告诉服务器:“这次通信后就关闭连接”。
+ 通常服务器端不会主动关闭连接。

###### 关闭长链接
1. 客户端，可以在请求头里加上``Connection: close``字段。
2. 使用``keepalive_timeout``，设置长连接的超时时间。
3. 使用``keepalive_requests``，设置长连接上可发送的最大请求次数。

## 队头阻塞
+ “队头阻塞”与短连接和长连接无关，而是由HTTP基本的“请求-应答”模型所导致的。
+ HTTP规定报文必须是“一发一收”，这就形成了一个先进先出的“串行”队列。队列里的请求没有轻 重缓急的优先级，只有入队的先后顺序，排在最前面的请求被最优先处理。
+ 解决队头阻塞，在http1.1只能是在客户端并发长链接。（对服务器要求高）

![http_队头阻塞](../../Images/http/http_队头阻塞.png)

#### 性能优化
因为“请求-应答”模型不能变，所以“队头阻塞”问题在HTTP/1.1里无法解决，只能缓解。
+ 并发连接（concurrent connections），也就是同时对一个域名发起多个长连接，用数量来解决质量的问题。（客户端建立多个链接）
+ 域名分片（domain sharding），多开几个域名，指向同一台服务器。




